<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>标注和标注图层-海量点</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
    <style>
        html,
        body,
        #container {
            height: 100%;
            width: 100%;
            margin: 0;
        }

        .amap-info-window {
            width: 150px;
            background: #fff;
            border-radius: 3px;
            padding: 3px 7px;
            box-shadow: 0 2px 6px 0 rgba(114, 124, 245, .5);
            position: relative;
        }

        .amap-info-sharp {
            position: absolute;
            top: 21px;
            bottom: 0;
            left: 50%;
            margin-left: -8px;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #fff;
        }
    </style>
</head>

<body>
    <div id="container"></div>

    <div class="info">
        海量点展示: 30000
    </div>
    <script type="text/javascript"
        src="https://webapi.amap.com/maps?v=2.0&key=b313fdb3684488ba9b6d1891a6f594af"></script>
    <script type="text/javascript"
        src="https://a.amap.com/jsapi_demos/static/demo-center/data/mock_position.js"></script>
    <script type="module">
        import {
            data1,
            data2,
            data3,
            data4,
            data5,
            data6,
            data7,
        } from "./LabelsLayer.js";
        console.log('data1', data1);
        var icon = {
            // 图标类型，现阶段只支持 image 类型
            type: 'image',
            // 图片 url
            image:
                'https://a.amap.com/jsapi_demos/static/demo-center/marker/express2.png',
            // 图片尺寸
            size: [64, 30],
            // 图片相对 position 的锚点，默认为 bottom-center
            anchor: 'center',
        };
        var textStyle = {
            fontSize: 12,
            fontWeight: 'normal',
            fillColor: '#22886f',
            strokeColor: '#fff',
            strokeWidth: 2,
            fold: true,
            padding: '2, 5',
        };
        var LabelsData = []
        data1.data.records.forEach((item, index) => {
            LabelsData.push({
                poiId: item.poiId,
                name: item.poiName,
                content: item.address,
                position: [item.poiLng, item.poiLat],
                zooms: [10, 20],
                opacity: 1,
                zIndex: index + 1,
                icon,
                text: {
                    content: item.poiName,
                    direction: 'right',
                    offset: [-20, -5],
                    style: textStyle,
                },
            })
        })
        data2.data.records.forEach((item, index) => {
            LabelsData.push({
                poiId: item.poiId,
                name: item.poiName,
                content: item.address,
                position: [item.poiLng, item.poiLat],
                zooms: [10, 20],
                opacity: 1,
                zIndex: index + 1,
                icon,
                text: {
                    content: item.poiName,
                    direction: 'right',
                    offset: [-20, -5],
                    style: textStyle,
                },
            })
        })
        data3.data.records.forEach((item, index) => {
            LabelsData.push({
                poiId: item.poiId,
                name: item.poiName,
                content: item.address,
                position: [item.poiLng, item.poiLat],
                zooms: [10, 20],
                opacity: 1,
                zIndex: index + 1,
                icon,
                text: {
                    content: item.poiName,
                    direction: 'right',
                    offset: [-20, -5],
                    style: textStyle,
                },
            })
        })
        data4.data.records.forEach((item, index) => {
            LabelsData.push({
                poiId: item.poiId,
                name: item.poiName,
                content: item.address,
                position: [item.poiLng, item.poiLat],
                zooms: [10, 20],
                opacity: 1,
                zIndex: index + 1,
                icon,
                text: {
                    content: item.poiName,
                    direction: 'right',
                    offset: [-20, -5],
                    style: textStyle,
                },
            })
        })
        data5.data.records.forEach((item, index) => {
            LabelsData.push({
                poiId: item.poiId,
                name: item.poiName,
                content: item.address,
                position: [item.poiLng, item.poiLat],
                zooms: [10, 20],
                opacity: 1,
                zIndex: index + 1,
                icon,
                text: {
                    content: item.poiName,
                    direction: 'right',
                    offset: [-20, -5],
                    style: textStyle,
                },
            })
        })
        data6.data.records.forEach((item, index) => {
            LabelsData.push({
                poiId: item.poiId,
                name: item.name,
                content: item.type,
                position: [item.point.lon, item.point.lat],
                zooms: [10, 20],
                opacity: 1,
                zIndex: index + 1,
                icon,
                text: {
                    content: item.name,
                    direction: 'right',
                    offset: [-20, -5],
                    style: textStyle,
                },
            })
        })
        data7.data.records.forEach((item, index) => {
            LabelsData.push({
                poiId: item.poiId,
                name: item.name,
                content: item.type,
                position: [item.point.lon, item.point.lat],
                zooms: [10, 20],
                opacity: 1,
                zIndex: index + 1,
                icon,
                text: {
                    content: item.name,
                    direction: 'right',
                    offset: [-20, -5],
                    style: textStyle,
                },
            })
        })


        var map = new AMap.Map('container', {
            zoom: 9,
            viewMode: '3D',
            center: [119.161721, 36.707668],
            mapStyle: 'amap://styles/whitesmoke',
            showLabel: false,
            showIndoorMap: false,
        });

        map.on('complete', function () {
            // 创建 AMap.LabelsLayer 图层
            var layer = new AMap.LabelsLayer({
                zooms: [3, 20],
                zIndex: 1000,
                collision: false
            });

            // 将图层添加到地图
            map.add(layer);

            var markers = [];
            var positions = Positions.slice(0, 3E4);

            var icon = {
                type: 'image',
                image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                size: [6, 9],
                anchor: 'bottom-center',
            };

            for (var i = 0; i < LabelsData.length; i++) {
                var item = LabelsData[i];
                item.extData = {
                    index: i,
                    ...item
                };

                var labelMarker = new AMap.LabelMarker(item);


                labelMarker.on('click', function (e) {
                    console.log('触发地图鼠标左键单击事件', e.target._opts.extData);
                });

                // 给marker绑定事件
                // labelMarker.on('mouseover', function (e) {
                //     var position = e.data.data && e.data.data.position;

                //     if (position) {
                //         normalMarker.setContent(
                //             '<div class="amap-info-window">'
                //             + position +
                //             '<div class="amap-info-sharp"></div>' +
                //             '</div>');
                //         normalMarker.setPosition(position);
                //         map.add(normalMarker);
                //     }
                // });

                // labelMarker.on('mouseout', function () {
                //     map.remove(normalMarker);
                // });
                markers.push(labelMarker);
            }

            // 一次性将海量点添加到图层
            layer.add(markers);

            // 普通点
            var normalMarker = new AMap.Marker({
                anchor: 'bottom-center',
                offset: [0, -15],
            });
        });
    </script>
</body>

</html>